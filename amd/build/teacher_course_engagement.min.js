define ("local_ace/teacher_course_engagement",["exports","core/ajax","core/chart_builder","core/chart_output_chartjs","core/notification","core/modal_factory","core/modal_events","core/chartjs-lazy","core/templates","local_ace/chart_filters"],function(a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=k(b);c=k(c);d=k(d);e=k(e);f=k(f);g=k(g);h=k(h);i=k(i);function k(a){return a&&a.__esModule?a:{default:a}}var l=[],m=[],n=[];a.init=function init(a){n=a.colours;(0,j.init)(p);p(null,null);document.querySelector("#course-filter").addEventListener("click",o)};var o=function(){var a=f.default.create({type:f.default.types.SAVE_CANCEL});a.then(function(a){a.getRoot()[0].classList.add("chart-comparison-modal");a.setTitle("Course filter");var b=i.default.render("local_ace/course_filter_modal",{courses:m});a.setBody(b);a.setSaveButtonText("Filter");a.getRoot().on(g.default.bodyRendered,function(){l.forEach(function(a){var b=document.querySelector("input[id=course-filter-"+a+"]");if(null!==b){b.checked=!1}})});a.getRoot().on(g.default.save,function(){var a=document.querySelectorAll("input[name=\"course-filter-options\"]:not(:checked)");a.forEach(function(a){if(!l.includes(a.value)){l.push(a.value)}});p()});a.getRoot().on(g.default.hidden,function(){a.destroy()});a.show();return a}).fail(e.default.exception)},p=function(a,b){var f=w(a,b).then(function(a){if(null!==a.error||0===a.series.length){v(a.error);return null}var b=r();m=[];var c=0;a.series.forEach(function(a){m.push({shortname:a.label});var d=q();d.label=a.label;d.values=a.values;d.colors=[n[c%n.length]];c++;b.series.push(d)});b.labels=a.xlabels;b.axes.y[0].max=100;b.axes.y[0].stepSize=20;var d={};a.ylabels.forEach(function(a){d[a.value]=a.label});b.axes.y[0].labels=d;if(8<a.series.length){document.querySelector("#course-filter-wrap").style.display=null}return b}).catch(function(){v("API Error")});f.then(function(a){if(null===a){return}var b=document.querySelector("#chart-area-engagement"),f=b.querySelector(".chart-image");f.innerHTML="";c.default.make(a).then(function(a){new d.default(f,a);u().then(function(a){if(a.error){return}var b=a.preferences[0].value;if(null===b){return}l.push(b.split(","));h.default.helpers.each(h.default.instances,function(a){var b=a.chart;for(var c in b.data.datasets){var d=b.data.datasets[c];if(l.includes(d.label)){d.hidden=!0}}b.update()})}).fail(e.default.exception)}).catch()}).catch()},q=function(){return{label:"",labels:null,type:null,values:[],colors:[],fill:null,axes:{x:null,y:null},urls:[],smooth:null}},r=function(){return{type:"line",series:[],labels:[],title:"Course Engagement",axes:{x:[],y:[{label:null,labels:{},max:100,min:0,position:null,stepSize:null}]},legend_options:{display:!0,position:"right",onClick:s},config_colorset:null,smooth:!0}},s=function(a,b){var c=b.datasetIndex,d=this.chart,e=d.getDatasetMeta(c);if(null===e.hidden){if(d.data.datasets[c].hidden){l=l.filter(function(a){return a!==d.data.datasets[c].label});t();d.data.datasets[c].hidden=!1}else{l.push(d.data.datasets[c].label);t();d.data.datasets[c].hidden=!0}}d.update()},t=function(){var a={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"local_ace_teacher_hidden_courses",value:l.join(",")}]}};b.default.call([a])[0].fail(e.default.exception)},u=function(){return b.default.call([{methodname:"core_user_get_user_preferences",args:{name:"local_ace_teacher_hidden_courses"}}])[0]},v=function(a){var b=document.querySelector("#chart-area-engagement"),c=b.querySelector(".chart-image");c.innerHTML=a},w=function(a,c){return b.default.call([{methodname:"local_ace_get_teacher_course_analytics_graph",args:{start:a,end:c}}])[0]}});
//# sourceMappingURL=teacher_course_engagement.min.js.map
